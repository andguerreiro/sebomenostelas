<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Desde outubro de 2017. O objetivo é incentivar a leitura de livros impressos e reduzir o uso de telas.">
    <title>Acervo Sebo Menos Telas - Sebo digital de livros usados</title>
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 20px;
            color: #000;
            background-color: #fff;
        }
        h2 {
            text-align: center;
            color: #000;
            margin-bottom: 25px;
        }
        #searchInput {
            width: 100%;
            max-width: 600px;
            padding: 12px 15px;
            margin: 0 auto 25px auto;
            display: block;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        #searchInput:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
        }
        
        /* Contêiner da Grade de Livros: SEMPRE 1 livro por linha */
        #bookGridContainer {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding-bottom: 20px;
            max-width: 960px;
            margin: 0 auto;
        }

        /* Estilo do Cartão de Livro Individual */
        .book-card {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: grid; 
            gap: 10px 15px;
        }

        .book-card-item {
            line-height: 1.4;
        }
        .book-card-item b {
            display: block;
            font-size: 0.9em;
            color: #000;
            margin-bottom: 2px;
        }
        .buy-button {
            grid-column: 1 / -1;
            display: block;
            background-color: #000;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            margin-top: 10px;
            justify-self: center;
            width: fit-content;
        }
        .buy-button:hover {
            background-color: #444;
        }
        
        /* Media Queries para responsividade das COLUNAS DOS CAMPOS DENTRO DO LIVRO */
        @media (min-width: 1200px) {
            .book-card {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        @media (min-width: 992px) and (max-width: 1199px) {
            .book-card {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (min-width: 769px) and (max-width: 991px) {
            .book-card {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Para telas pequenas (até 768px, smartphones): 1 coluna de campos */
        @media (max-width: 768px) {
            body {
                margin: 10px;
            }
            #bookGridContainer {
                gap: 15px;
            }
            .book-card {
                grid-template-columns: 1fr;
                gap: 0;
                padding: 12px;
            }
            .book-card-item {
                margin-bottom: 8px;
            }
            .book-card-item b {
                display: inline;
                font-size: 1em;
                color: #000;
                margin-bottom: 0;
            }
            .buy-button {
                margin-top: 10px;
                justify-self: stretch;
            }
        }
    </style>
</head>
<body>

    <h2>Acervo <a href="index.html" target="_blank">Sebo Menos Telas</a></h2>

    <input type="text" id="searchInput" onkeyup="filterContent()" placeholder="Pesquisar por Título, Autor, Editora, etc...">

    <div id="bookGridContainer"></div>

    <script>
        window.onload = function() {
            generateContent();
        };

        async function generateContent() {
            let tsvContent;
            try {
                const response = await fetch('livros.tsv'); // Pega o conteúdo do arquivo externo
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                tsvContent = await response.text();
            } catch (error) {
                console.error('Erro ao carregar o arquivo TSV:', error);
                document.getElementById("bookGridContainer").innerHTML = '<p>Erro ao carregar o acervo. Por favor, tente novamente mais tarde.</p>';
                return;
            }

            var lines = tsvContent.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return;

            var headers = lines[0].split('\t');
            
            var precoIndex = headers.findIndex(h => h.toLowerCase().trim() === 'preço');
            var freteIndex = headers.findIndex(h => h.toLowerCase().trim() === 'frete');
            var totalIndex = headers.findIndex(h => h.toLowerCase().trim() === 'total');

            var cardsHtml = '';
            
            for (var i = 1; i < lines.length; i++) {
                var cells = lines[i].split('\t');
                if (cells.length === headers.length) {
                    var cardHtml = '<div class="book-card">';
                    
                    for (var j = 0; j < cells.length; j++) {
                        var header = headers[j].trim();
                        var value = cells[j].trim();

                        if (j === precoIndex || j === freteIndex || j === totalIndex) {
                           var numericValue = parseFloat(value.replace(',', '.'));
                           value = isNaN(numericValue) ? value : numericValue.toFixed(2).replace('.', ',');
                        }

                        if (header.toLowerCase() === 'comprar') {
                            var titleIndex = headers.findIndex(h => h.toLowerCase().trim() === 'título');
                            var authorIndex = headers.findIndex(h => h.toLowerCase().trim() === 'autor');
                            var whatsappLink = '#';

                            if (titleIndex > -1 && authorIndex > -1) {
                                var title = cells[titleIndex];
                                var author = cells[authorIndex];
                                var message = 'Oi! Quero comprar o livro ' + title + ' de ' + author;
                                whatsappLink = 'https://wa.me/5511981350566?text=' + encodeURIComponent(message);
                            }
                            cardHtml += '<div class="book-card-item"><a href="' + whatsappLink + '" class="buy-button" target="_blank">Comprar pelo WhatsApp</a></div>';
                        } else {
                            cardHtml += '<div class="book-card-item"><b>' + header + ':</b> ' + (value || '') + '</div>';
                        }
                    }
                    cardHtml += '</div>';
                    cardsHtml += cardHtml;
                }
            }
            document.getElementById("bookGridContainer").innerHTML = cardsHtml;
        }

        function filterContent() {
            var input, filter, cards, i, cardText;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();

            cards = document.getElementById("bookGridContainer").getElementsByClassName("book-card");
            for (i = 0; i < cards.length; i++) {
                cardText = cards[i].textContent || cards[i].innerText;
                if (cardText.toUpperCase().indexOf(filter) > -1) {
                    cards[i].style.display = "grid";
                } else {
                    cards[i].style.display = "none";
                }
            }
        }
    </script>
</body>
</html>
