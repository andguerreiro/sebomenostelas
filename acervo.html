<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Desde outubro de 2017. O objetivo é incentivar a leitura de livros impressos e reduzir o uso de telas.">
    <title>Acervo Sebo Menos Telas - Sebo digital de livros usados</title>
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 20px;
            color: #000;
            background-color: #fff;
        }
        h2 {
            text-align: center;
            color: #000;
            margin-bottom: 25px;
        }
        h2 a {
            color: #000;
            text-decoration: underline;
        }
        #searchInput {
            width: 100%;
            max-width: 600px;
            padding: 12px 15px;
            margin: 0 auto 15px auto; /* Ajuste para dar espaço ao botão */
            display: block;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        #searchInput:focus {
            outline: none;
            border-color: #000;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.1);
        }
        
        /* Contêiner dos botões */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px; /* Espaço entre os botões */
            margin-bottom: 25px;
        }

        /* Estilo do botão de pesquisa */
        .search-button {
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #000;
            background-color: #000;
            color: white;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            min-width: 120px; /* Mantém largura similar aos botões anteriores */
        }
        .search-button:hover {
            background-color: #444;
        }

        #bookGridContainer {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            padding-bottom: 20px;
            max-width: 960px;
            margin: 0 auto;
        }

        .book-card {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: grid; 
            gap: 10px 15px;
        }

        .book-card-item {
            line-height: 1.4;
        }
        .book-card-item b {
            display: block;
            font-size: 0.9em;
            color: #000;
            margin-bottom: 2px;
        }
        .buy-button {
            grid-column: 1 / -1;
            display: block;
            background-color: #000;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            margin-top: 10px;
            justify-self: center;
            width: fit-content;
        }
        .buy-button:hover {
            background-color: #444;
        }
        
        .no-results {
            text-align: center;
            color: #555;
            font-style: italic;
            margin-top: 50px;
            display: none; /* OCULTA A MENSAGEM INICIALMENTE */
        }
        
        /* Media Queries para responsividade das COLUNAS DOS CAMPOS DENTRO DO LIVRO */
        @media (min-width: 1200px) {
            .book-card {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        @media (min-width: 992px) and (max-width: 1199px) {
            .book-card {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (min-width: 769px) and (max-width: 991px) {
            .book-card {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Para telas pequenas (até 768px, smartphones): 1 coluna de campos */
        @media (max-width: 768px) {
            body {
                margin: 10px;
            }
            #bookGridContainer {
                gap: 15px;
            }
            .book-card {
                grid-template-columns: 1fr;
                gap: 0;
                padding: 12px;
            }
            .book-card-item {
                margin-bottom: 8px;
            }
            .book-card-item b {
                display: inline;
                font-size: 1em;
                color: #000;
                margin-bottom: 0;
            }
            .buy-button {
                margin-top: 10px;
                justify-self: stretch;
            }
        }
    </style>
</head>
<body>

    <h2>Acervo <a href="index.html">Sebo Menos Telas</a></h2>

    <input type="text" id="searchInput" onkeydown="handleKeyPress(event)" placeholder="Pesquisar por Título, Autor, Editora, etc...">

    <div class="button-container">
        <button onclick="filterContent()" class="search-button">Pesquisar</button>
    </div>

    <div id="bookGridContainer"></div>
    <div id="noResultsMessage" class="no-results">Nenhum livro encontrado.</div>

    <script>
        let allBooks = []; // Variável para armazenar todos os livros

        window.onload = function() {
            loadTsvData(); // Carrega os dados do TSV, mas não exibe os livros inicialmente
        };

        async function loadTsvData() {
            try {
                const response = await fetch('livros.tsv');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const tsvContent = await response.text();
                parseTsvContent(tsvContent);
            } catch (error) {
                console.error('Erro ao carregar o arquivo TSV:', error);
                document.getElementById("bookGridContainer").innerHTML = '<p>Erro ao carregar o acervo. Por favor, tente novamente mais tarde.</p>';
                document.getElementById("noResultsMessage").style.display = 'none'; // Esconde a mensagem "Nenhum livro encontrado" em caso de erro de carregamento.
            }
        }

        function parseTsvContent(tsvContent) {
            const lines = tsvContent.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) {
                // Se o arquivo TSV estiver vazio ou tiver apenas o cabeçalho, a lista de allBooks permanecerá vazia.
                // A mensagem "Nenhum livro encontrado" será gerenciada por filterContent() na primeira pesquisa.
                return;
            }

            const headers = lines[0].split('\t');
            
            const precoIndex = headers.findIndex(h => h.toLowerCase().trim() === 'preço');
            const freteIndex = headers.findIndex(h => h.toLowerCase().trim() === 'frete');
            const totalIndex = headers.findIndex(h => h.toLowerCase().trim() === 'total');
            const titleIndex = headers.findIndex(h => h.toLowerCase().trim() === 'título');
            const authorIndex = headers.findIndex(h => h.toLowerCase().trim() === 'autor');

            for (let i = 1; i < lines.length; i++) {
                const cells = lines[i].split('\t');
                if (cells.length === headers.length) {
                    const book = {};
                    book.html = '';
                    for (let j = 0; j < cells.length; j++) {
                        const header = headers[j].trim();
                        let value = cells[j].trim();

                        if (j === precoIndex || j === freteIndex || j === totalIndex) {
                           const numericValue = parseFloat(value.replace(',', '.'));
                           value = isNaN(numericValue) ? value : numericValue.toFixed(2).replace('.', ',');
                        }

                        if (header.toLowerCase() === 'comprar') {
                            let whatsappLink = '#';
                            if (titleIndex > -1 && authorIndex > -1) {
                                const title = cells[titleIndex];
                                const author = cells[authorIndex];
                                const message = `Oi! Quero comprar o livro ${title} de ${author}`;
                                whatsappLink = `https://wa.me/5511981350566?text=${encodeURIComponent(message)}`;
                            }
                            book.html += `<div class="book-card-item"><a href="${whatsappLink}" class="buy-button" target="_blank">Comprar</a></div>`;
                        } else {
                            book.html += `<div class="book-card-item"><b>${header}:</b> ${value || ''}</div>`;
                        }
                    }
                    book.html = `<div class="book-card">${book.html}</div>`;
                    book.text = cells.join(' ').toUpperCase(); // Para busca
                    allBooks.push(book);
                }
            }
        }

        function filterContent() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase().trim();
            let cardsHtml = '';
            let resultsFound = false;

            if (filter === "" && allBooks.length > 0) { // Se a pesquisa estiver vazia e houver livros, exibe a mensagem de "Nenhum livro encontrado."
                document.getElementById("bookGridContainer").innerHTML = '';
                document.getElementById("noResultsMessage").style.display = 'block';
                return;
            }

            for (let i = 0; i < allBooks.length; i++) {
                if (allBooks[i].text.indexOf(filter) > -1) {
                    cardsHtml += allBooks[i].html;
                    resultsFound = true;
                }
            }

            document.getElementById("bookGridContainer").innerHTML = cardsHtml;
            document.getElementById("noResultsMessage").style.display = resultsFound ? 'none' : 'block';
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                filterContent();
            }
        }
    </script>
</body>
</html>
